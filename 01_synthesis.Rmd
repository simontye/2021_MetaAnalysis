---
title: "synthesis"
author: "SPT"
date: "2021_10_08"
output: github_document
---

### Step 1: Load packages and data

```{r, echo = `FALSE`}
# Install packages
#devtools::install_github("MathiasHarrer/dmetar")
#devtools::install_github("daniel1noble/metaDigitise")
#install.packages("searcher")

# Load packages
library(tidyverse)
library(meta)
library(metafor)
library(esc)
library(gdata)
library(searcher)
library(metaDigitise)
#library(dmetar)

# Reset global environment
rm(list = ls())

# Change working directory
setwd("/Users/simontye/Research/Projects/Meta_Analysis/2021_MetaAnalysis")

# Load Web of Science data (WoS)
wos.comp <- read.csv(file = "data/papers/wos_comp.csv",  head = TRUE, sep = ",")
wos.pred <- read.csv(file = "data/papers/wos_pred.csv", head = TRUE, sep = ",")
wos.mut  <- read.csv(file = "data/papers/wos_mutual.csv", head = TRUE, sep = ",")
chamber  <- read.csv(file = "data/papers/chamberlain.csv", head = TRUE, sep = ",")
```

```{r, echo = `FALSE`}
# Function to insert rows for papers with multiple effect sizes
add.rows <- function(data,
                     new.row,
                     r) {
  data[seq(r + 1, nrow(data) + 1),] <- data[seq(r, nrow(data)),]
  data[r, ] <- new.row
  data
}

# Function to include or exclude an article
ma.eval <- function(input,
                    article.id,
                    include,
                    comment) {
  # Add study details in effect size df
  input[article.id, c(8:9)] <- c(include, comment)
  # Choose output
  return(input)
}

# Function to calculate effect sizes
ma.es <- function(input,
                  output,
                  article.id,
                  study.data) {
  if(study.data["measure"] == "Mean" && study.data["direction"] == "-") {
  study.es <- esc_mean_sd(grp1m  = as.numeric(study.data[c("mean.e")]),
                          grp1sd = as.numeric(study.data[c("error.e")]),
                          grp1n  = as.numeric(study.data[c("n.e")]),
                          grp2m  = as.numeric(study.data[c("mean.c")]),
                          grp2sd = as.numeric(study.data[c("error.c")]),
                          grp2n  = as.numeric(study.data[c("n.c")]))    
  } 
  if(study.data["measure"] == "Mean" && study.data["direction"] == "+") {
  study.es <- esc_mean_sd(grp1m  = as.numeric(study.data[c("mean.c")]),
                          grp1sd = as.numeric(study.data[c("error.c")]),
                          grp1n  = as.numeric(study.data[c("n.c")]),
                          grp2m  = as.numeric(study.data[c("mean.e")]),
                          grp2sd = as.numeric(study.data[c("error.e")]),
                          grp2n  = as.numeric(study.data[c("n.e")]))
  }
  if(study.data["measure"] != "Mean") {
  study.es <- data.frame(es    = NA,
                         se    = NA,
                         var   = NA,
                         ci.lo = NA,
                         ci.hi = NA,
                         w     = NA)
  }
  # Add study details
  output <- add.rows(output, c(input[article.id, 1:8],
                               study.data[1:24],
                               as.numeric(study.es$es),
                               as.numeric(study.es$se),
                               as.numeric(study.es$var),
                               as.numeric(study.es$ci.lo),
                               as.numeric(study.es$ci.hi),
                               as.numeric(study.es$w)),
                     sum(nrow(output)) + 1)
  # Remove empty columns
  output <- filter(output, !is.na(id))
  # Choose output
  return(output)
}

# Function to search Google for paper title
ma.search <- function(input, article.id) {
  # Filter article
  tmp <- filter(input, id == as.numeric(article.id))
  # Search Google
  search_google(query = tmp$title, rlang = FALSE)
  # Choose output
  return(tmp)
}

# Function to monitor progress
ma.status <- function(wos, es) {
  # Number of articles
  articles <- as.numeric(nrow(wos))
  # Number of evaluated articles
  eval <- wos %>%
    filter(!is.na(include))
  eval <- as.numeric(nrow(eval))
  # Number of good articles
  good <- wos %>%
    filter(include == "yes" | include == "prob yes")
  good <- as.numeric(nrow(good))
  # Number of bad articles
  bad <- eval - good
  # Number of effect sizes
  es <- as.numeric(nrow(es))
  # Percent complete
  percent <- round((eval / articles * 100), 2)
  
  # Create output
  paper.count   <- paste0("1. Completed ", percent, "% (", eval, "/699) of article evaluations.")
  good.count    <- paste0("2. Found ", good, " articles that may have relevant information.")
  bad.count     <- paste0("3. Found ", bad, " articles that do not have relevant information.")
  #es.count      <- paste0("4. Calculated ", es, " effect size(s).")
  # Choose output
  return(cat(paper.count,
             good.count,
             bad.count,
             #es.count,
             sep = "\n"))
}

# Function to print or search abstract
ma.abstract <- function(wos, article.id) {
  # Print or search for abstract
  article <- ifelse(is.na(wos[article.id, "abstract"]),
                    ma.search(wos, article.id),
                    wos[article.id, "abstract"])
  # Choose output
  return(article)
}

# Plot theme
pretty <- theme_classic(base_size = 10) +
  theme(axis.title.y      = element_text(margin = margin(r = 10)),
        axis.title.x      = element_text(margin = margin(t = 10)), 
        axis.text         = element_text(color = "black"), 
        axis.ticks        = element_line(color = "black"),
        axis.ticks.length = unit(.25, "cm"), 
        legend.key.size   = unit(1.5,  'lines'),
        legend.position   = "right")
```

### Step 2: Format data

```{r echo = `FALSE`}
# Combine WoS data
wos <- wos.comp %>%
  rbind(., wos.pred, wos.mut) %>%
  rename_all(tolower) %>%
  dplyr::select(., c(publication.year, article.title, authors,
                     source.title, book.series.title, abstract)) %>%
  dplyr::rename(title   = article.title,
                journal = source.title,
                book    = book.series.title,
                year    = publication.year) %>%
  arrange(year, title) %>%
  mutate_all(na_if,"") %>%
  mutate(id      = row_number(),
         include = as.character(NA),
         comment = as.character(NA)) %>%
  dplyr::select(., c(id, year, title, authors,
                     journal, book, abstract,
                     include, comment))

# Format Chamberlain data
chamber <- chamber %>%
  rename_all(tolower) %>%
  dplyr::rename(year     = publication.year,
                authors  = author,
                journal  = publication.title,
                abstract = abstract.note) %>%
  dplyr::select(., c(year, title, authors, journal, abstract)) %>%
  mutate_all(na_if,"") %>%
  mutate(id      = row_number(),
         book    = as.character(NA),
         include = "yes",
         comment = as.character(NA)) %>%
  dplyr::select(., c(id, year, title, authors,
                     journal, book, abstract,
                     include, comment))

# Create empty df to store effect sizes
es <- data.frame(id            = as.character(NA),
                 year          = as.character(NA),
                 title         = as.character(NA),
                 authors       = as.character(NA),
                 journal       = as.character(NA),
                 book          = as.character(NA),
                 abstract      = as.character(NA),
                 include       = as.character(NA),
                 comment       = as.character(NA),
                 es.id         = as.character(NA),
                 focal.species = as.character(NA),
                 focal.n       = as.character(NA),
                 focal.density = as.character(NA),
                 focal.size    = as.character(NA),
                 mut.species   = as.character(NA),
                 mut.n         = as.character(NA),
                 mut.density   = as.character(NA),
                 mut.size      = as.character(NA),
                 comp.species  = as.character(NA), 
                 comp.n        = as.character(NA),
                 comp.density  = as.character(NA),
                 comp.size     = as.character(NA),
                 pred.species  = as.character(NA), 
                 pred.n        = as.character(NA),  
                 pred.density  = as.character(NA),
                 pred.size     = as.character(NA),
                 interaction   = as.character(NA),   
                 trait         = as.character(NA),         
                 treatment     = as.character(NA),
                 location      = as.character(NA),      
                 measure       = as.character(NA),       
                 direction     = as.character(NA),
                 es            = as.character(NA),
                 se            = as.character(NA),
                 var           = as.character(NA),
                 ci.lo         = as.character(NA),
                 ci.hi         = as.character(NA),
                 w             = as.character(NA))

# Remove objects
rm(wos.comp, wos.pred, wos.mut)
```

### Step 3: Evaluate articles

```{r, echo = `FALSE`}
# Evaluate articles
wos <- ma.eval(wos, 1,    "no", "economics")
wos <- ma.eval(wos, 2,    "no", "evo")
wos <- ma.eval(wos, 3,    "no", "agricultural model")
wos <- ma.eval(wos, 4,    "yes", "mut, field exp")
wos <- ma.eval(wos, 5,    "yes", "comp, field exp")
wos <- ma.eval(wos, 6,    "yes", "comp, resource pulse, field exp")
wos <- ma.eval(wos, 7,    "yes", "comp, field exp")
wos <- ma.eval(wos, 8,    "no", "economics")
wos <- ma.eval(wos, 9,    "prob no", "virus")
wos <- ma.eval(wos, 10,   "prob no", "intra feeding behavior")
wos <- ma.eval(wos, 11,   "yes", "pred, field exp")
wos <- ma.eval(wos, 12,   "no", "electronics")
wos <- ma.eval(wos, 13,   "no", "english")
wos <- ma.eval(wos, 14,   "prob yes", "comp, field exp")
wos <- ma.eval(wos, 15,   "prob yes", "comp, field exp")
wos <- ma.eval(wos, 16,   "prob yes", "comp, field exp")
wos <- ma.eval(wos, 17,   "maybe", "comp, co2, field exp")
wos <- ma.eval(wos, 18,   "prob yes", "mut, field exp")
wos <- ma.eval(wos, 19,   "maybe", "read")
wos <- ma.eval(wos, 20,   "yes", "field exp")
wos <- ma.eval(wos, 21,   "yes", "field exp")
wos <- ma.eval(wos, 22,   "yes", "field exp")
wos <- ma.eval(wos, 23,   "yes", "field exp")
wos <- ma.eval(wos, 24,   "no", "economics")
wos <- ma.eval(wos, 25,   "maybe", "read")
wos <- ma.eval(wos, 26,   "no", "obituary")
wos <- ma.eval(wos, 27,   "yes", "comp, field exp")
wos <- ma.eval(wos, 28,   "yes", "comp, field exp")
wos <- ma.eval(wos, 29,   "prob not", "obs")
wos <- ma.eval(wos, 30,   "prob yes", "removal, field exp")
wos <- ma.eval(wos, 31,   "no", "weird")
wos <- ma.eval(wos, 32,   "prob yes", "removal")
wos <- ma.eval(wos, 33,   "no", "human")
wos <- ma.eval(wos, 34,   "prob yes", "field exp")
wos <- ma.eval(wos, 35,   "prob yes", "field exp")
wos <- ma.eval(wos, 36,   "no", "human, model")
wos <- ma.eval(wos, 37,   "no", "model")
wos <- ma.eval(wos, 38,   "no", "chemistry")
wos <- ma.eval(wos, 39,   "yes", "plants")
wos <- ma.eval(wos, 40,   "yes", "plants")
wos <- ma.eval(wos, 41,   "no", "model")
wos <- ma.eval(wos, 42,   "prob yes", "field exp")
wos <- ma.eval(wos, 43,   "no", "economics")
wos <- ma.eval(wos, 44,   "no", "economics")
wos <- ma.eval(wos, 45,   "prob yes", "mut, field exp")
wos <- ma.eval(wos, 46,   "prob yes", "mut, field exp")
wos <- ma.eval(wos, 47,   "no", "electronics")
wos <- ma.eval(wos, 48,   "maybe", "read")
wos <- ma.eval(wos, 49,   "no", "economics")
wos <- ma.eval(wos, 50,   "no", "model")
wos <- ma.eval(wos, 51,   "maybe", "polyploid")
wos <- ma.eval(wos, 52,   "no", "human")
wos <- ma.eval(wos, 53,   "no", "economics")
wos <- ma.eval(wos, 54,   "no", "economics")
wos <- ma.eval(wos, 55,   "yes", "field exp")
wos <- ma.eval(wos, 56,   "no", "model")
wos <- ma.eval(wos, 57,   "yes", "field exp")
wos <- ma.eval(wos, 58,   "prob yes", "read")
wos <- ma.eval(wos, 59,   "maybe", "obs")
wos <- ma.eval(wos, 60,   "prob yes", "field exp")
wos <- ma.eval(wos, 61,   "yes", "field exp")
wos <- ma.eval(wos, 62,   "yes", "protein")
wos <- ma.eval(wos, 63,   "yes", "field exp")
wos <- ma.eval(wos, 64,   "prob yes", "removal, field exp")
wos <- ma.eval(wos, 65,   "prob yes", "field exp")
wos <- ma.eval(wos, 66,   "yes", "review, read")
wos <- ma.eval(wos, 67,   "no", "economics")
wos <- ma.eval(wos, 68,   "no", "humans")
wos <- ma.eval(wos, 69,   "no", "humans")
wos <- ma.eval(wos, 70,   "maybe", "read")
wos <- ma.eval(wos, 71,   "prob yes", "field exp")
wos <- ma.eval(wos, 72,   "no", "human")
wos <- ma.eval(wos, 73,   "prob not", "read, hermaphrodites")
wos <- ma.eval(wos, 74,   "prob not", "sperm comp")
wos <- ma.eval(wos, 75,   "prob yes", "comp, field exp")
wos <- ma.eval(wos, 76,   "no", "chemistry")
wos <- ma.eval(wos, 77,   "no", "chemistry")
wos <- ma.eval(wos, 78,   "no", "evolution")
wos <- ma.eval(wos, 79,   "yes", "field exp")
wos <- ma.eval(wos, 80,   "prob yes", "field exp")
wos <- ma.eval(wos, 81,   "prob yes", "read, old tree clearing")
wos <- ma.eval(wos, 82,   "prob yes", "field exp")
wos <- ma.eval(wos, 83,   "no", "human")
wos <- ma.eval(wos, 84,   "no", "what?")
wos <- ma.eval(wos, 85,   "maybe", "read")
wos <- ma.eval(wos, 86,   "prob yes", "field exp")
wos <- ma.eval(wos, 87,   "no", "human")
wos <- ma.eval(wos, 88,   "no", "human")
wos <- ma.eval(wos, 89,   "no", "economics")
wos <- ma.eval(wos, 90,   "no", "economics")
wos <- ma.eval(wos, 91,   "maybe", "cannibalism")
wos <- ma.eval(wos, 92,   "no", "economics")
wos <- ma.eval(wos, 93,   "prob yes", "plants, read")
wos <- ma.eval(wos, 94,   "no", "human")
wos <- ma.eval(wos, 95,   "prob not", "virus")
wos <- ma.eval(wos, 96,   "no", "human")
wos <- ma.eval(wos, 97,   "maybe", "pest species")
wos <- ma.eval(wos, 98,   "prob not", "obs")
wos <- ma.eval(wos, 99,   "prob yes", "field exp")
wos <- ma.eval(wos, 100,  "maybe", "pollen")
wos <- ma.eval(wos, 101,  "no", "economics")
wos <- ma.eval(wos, 102,  "no", "human")
wos <- ma.eval(wos, 103,  "maybe", "comp, field exp")
wos <- ma.eval(wos, 104,  "maybe", "polymorphism, intra")
wos <- ma.eval(wos, 105,  "yes", "comp, field exp")
wos <- ma.eval(wos, 106,  "no", "human")
wos <- ma.eval(wos, 107,  "prob yes", "fire exc, field exp")
wos <- ma.eval(wos, 108,  "maybe", "seems complex comm")
wos <- ma.eval(wos, 109,  "prob not", "self-compatbiilty")
wos <- ma.eval(wos, 110,  "maybe", "seems obs")
wos <- ma.eval(wos, 111,  "no", "human")
wos <- ma.eval(wos, 112,  "no", "human")
wos <- ma.eval(wos, 113,  "maybe", "seems complex comm")
wos <- ma.eval(wos, 114,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 115,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 116,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 117,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 118,  "no", "model")
wos <- ma.eval(wos, 119,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 120,  "no", "chemistry")
wos <- ma.eval(wos, 121,  "maybe", "neighbor removal")
wos <- ma.eval(wos, 122,  "no", "weird")
wos <- ma.eval(wos, 123,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 124,  "no", "electronics")
wos <- ma.eval(wos, 125,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 126,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 127,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 128,  "no", "model")
wos <- ma.eval(wos, 129,  "no", "model")
wos <- ma.eval(wos, 130,  "no", "sperm comp, review")
wos <- ma.eval(wos, 131,  "no", "economics")
wos <- ma.eval(wos, 132,  "maybe", "hermaphrodite")
wos <- ma.eval(wos, 133,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 134,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 135,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 136,  "prob not", "obs")
wos <- ma.eval(wos, 137,  "no", "weird")
wos <- ma.eval(wos, 138,  "no", "economics")
wos <- ma.eval(wos, 139,  "no", "economics")
wos <- ma.eval(wos, 140,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 141,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 142,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 143,  "no", "human, robot")
wos <- ma.eval(wos, 144,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 145,  "maybe", "self-comp")
wos <- ma.eval(wos, 146,  "no", "model")
wos <- ma.eval(wos, 147,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 148,  "no", "human")
wos <- ma.eval(wos, 149,  "no", "human")
wos <- ma.eval(wos, 150,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 151,  "maybe", "seems intra")
wos <- ma.eval(wos, 152,  "no", "sperm comp")
wos <- ma.eval(wos, 153,  "no", "soil comp for molecules")
wos <- ma.eval(wos, 154,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 155,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 156,  "prob not", "seems intra")
wos <- ma.eval(wos, 157,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 158,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 159,  "no", "economics")
wos <- ma.eval(wos, 160,  "maybe", "mixed tree stands")
wos <- ma.eval(wos, 161,  "maybe", "propaglue comp")
wos <- ma.eval(wos, 162,  "no", "model")
wos <- ma.eval(wos, 163,  "maybe", "read")
wos <- ma.eval(wos, 164,  "no", "sperm comp")
wos <- ma.eval(wos, 165,  "no", "method")
wos <- ma.eval(wos, 166,  "prob not", "hermaphrodite")
wos <- ma.eval(wos, 167,  "no", "volleyball?")
wos <- ma.eval(wos, 168,  "no", "economics")
wos <- ma.eval(wos, 169,  "no", "human")
wos <- ma.eval(wos, 170,  "prob yes", "field exp")
wos <- ma.eval(wos, 171,  "prob no", "intra, geno")
wos <- ma.eval(wos, 172,  "no", "economics")
wos <- ma.eval(wos, 173,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 174,  "yes", "comp, pred, field exp")
wos <- ma.eval(wos, 175,  "no", "economimcs")
wos <- ma.eval(wos, 176,  "yes", "comp, field exp")
wos <- ma.eval(wos, 177,  "maybe", "crossing, field exp")
wos <- ma.eval(wos, 178,  "no", "economimcs")
wos <- ma.eval(wos, 179,  "maybe", "read")
wos <- ma.eval(wos, 180,  "no", "chemistry")
wos <- ma.eval(wos, 181,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 182,  "no", "what?")
wos <- ma.eval(wos, 183,  "no", "economimcs")
wos <- ma.eval(wos, 184,  "maybe", "mut, field exp")
wos <- ma.eval(wos, 185,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 186,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 187,  "no", "economics")
wos <- ma.eval(wos, 188,  "no", "human")
wos <- ma.eval(wos, 189,  "yes", "comp, field exp")
wos <- ma.eval(wos, 190,  "yes", "comp, field exp")
wos <- ma.eval(wos, 191,  "yes", "comp, field exp")
wos <- ma.eval(wos, 192,  "maybe", "mut, comp, field exp")
wos <- ma.eval(wos, 193,  "prob yes", "pred, comp, field exp")
wos <- ma.eval(wos, 194,  "no", "economics")
wos <- ma.eval(wos, 195,  "no", "economics")
wos <- ma.eval(wos, 196,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 197,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 198,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 199,  "no", "human")
wos <- ma.eval(wos, 200,  "prob not", "intra sex")
wos <- ma.eval(wos, 201,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 202,  "prob not", "intra, field exp")
wos <- ma.eval(wos, 203,  "prob not", "intra, field exp")
wos <- ma.eval(wos, 204,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 205,  "prob not", "pollution, field exp")
wos <- ma.eval(wos, 206,  "prob not", "introduction, field exp")
wos <- ma.eval(wos, 207,  "no", "human")
wos <- ma.eval(wos, 208,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 209,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 210,  "no", "human")
wos <- ma.eval(wos, 211,  "prob yes", "pre, field exp")
wos <- ma.eval(wos, 212,  "prob not", "polymorph")
wos <- ma.eval(wos, 213,  "no", "chemistry")
wos <- ma.eval(wos, 214,  "maybe", "succession, field exp")
wos <- ma.eval(wos, 215,  "no", "human")
wos <- ma.eval(wos, 216,  "no", "economics")
wos <- ma.eval(wos, 217,  "no", "human")
wos <- ma.eval(wos, 218,  "maybe", "read, ma of bird food manipulation")
wos <- ma.eval(wos, 219,  "no", "human")
wos <- ma.eval(wos, 220,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 221,  "yes", "all, field exp")
wos <- ma.eval(wos, 222,  "problem", "same as 221")
wos <- ma.eval(wos, 223,  "prob not", "intrasex, exp")
wos <- ma.eval(wos, 224,  "no", "review, econ")
wos <- ma.eval(wos, 225,  "yes", "pred, field exp")
wos <- ma.eval(wos, 226,  "yes", "comp, field exp")
wos <- ma.eval(wos, 227,  "yes", "comp, field exp")
wos <- ma.eval(wos, 228,  "no", "human")
wos <- ma.eval(wos, 229,  "no", "human")
wos <- ma.eval(wos, 230,  "no", "human")
wos <- ma.eval(wos, 231,  "maybe", "lab exp")
wos <- ma.eval(wos, 232,  "no", "human")
wos <- ma.eval(wos, 233,  "maybe", "seems intra")
wos <- ma.eval(wos, 234,  "no", "human")
wos <- ma.eval(wos, 235,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 236,  "no", "human")
wos <- ma.eval(wos, 237,  "no", "cellular")
wos <- ma.eval(wos, 238,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 239,  "no", "human")
wos <- ma.eval(wos, 240,  "yes", "pred, field exp")
wos <- ma.eval(wos, 241,  "no", "intra, field exp")
wos <- ma.eval(wos, 242,  "maybe", "lab exp")
wos <- ma.eval(wos, 243,  "no", "economics")
wos <- ma.eval(wos, 244,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 245,  "no", "human")
wos <- ma.eval(wos, 246,  "no", "economics")
wos <- ma.eval(wos, 247,  "no", "economics")
wos <- ma.eval(wos, 248,  "yes", "pred, field exp")
wos <- ma.eval(wos, 249,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 250,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 251,  "maybe", "obs, fire")
wos <- ma.eval(wos, 252,  "no", "human")
wos <- ma.eval(wos, 253,  "no", "theory")
wos <- ma.eval(wos, 254,  "no", "human")
wos <- ma.eval(wos, 255,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 256,  "no", "model")
wos <- ma.eval(wos, 257,  "no", "obs")
wos <- ma.eval(wos, 258,  "no", "physics")
wos <- ma.eval(wos, 259,  "yes", "pred, field exp")
wos <- ma.eval(wos, 260,  "maybe", "comp, field exp")
wos <- ma.eval(wos, 261,  "no", "human")
wos <- ma.eval(wos, 262,  "no", "model")
wos <- ma.eval(wos, 263,  "maybe", "seems complex comm")
wos <- ma.eval(wos, 264,  "no", "economics")
wos <- ma.eval(wos, 265,  "prob not", "obs")
wos <- ma.eval(wos, 266,  "no", "tranportation")
wos <- ma.eval(wos, 267,  "no", "chemistry")
wos <- ma.eval(wos, 268,  "prob not", "cultivar")
wos <- ma.eval(wos, 269,  "prob not", "intra")
wos <- ma.eval(wos, 270,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 271,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 272,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 273,  "prob yes", "all, field exp")
wos <- ma.eval(wos, 274,  "prob yes", "all, field exp")
wos <- ma.eval(wos, 275,  "no", "economics")
wos <- ma.eval(wos, 276,  "prob yes", "lab exp")
wos <- ma.eval(wos, 277,  "no", "review")
wos <- ma.eval(wos, 278,  "maybe", "read")
wos <- ma.eval(wos, 279,  "no", "obs")
wos <- ma.eval(wos, 280,  "maybe", "read, mangrove, nutrients")
wos <- ma.eval(wos, 281,  "yes", "comp, field exp")
wos <- ma.eval(wos, 282,  "no", "human")
wos <- ma.eval(wos, 283,  "yes", "comp")
wos <- ma.eval(wos, 284,  "no", "chemistry")
wos <- ma.eval(wos, 285,  "no", "human")
wos <- ma.eval(wos, 286,  "no", "economics")
wos <- ma.eval(wos, 287,  "yes", "comp, field exp")
wos <- ma.eval(wos, 288,  "no", "economics")
wos <- ma.eval(wos, 289,  "yes", "comp, field exp")
wos <- ma.eval(wos, 290,  "maybe", "mut, field exp")
wos <- ma.eval(wos, 291,  "no", "human")
wos <- ma.eval(wos, 292,  "no", "human")
wos <- ma.eval(wos, 293,  "no", "human")
wos <- ma.eval(wos, 294,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 295,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 296,  "maybe", "ploids")
wos <- ma.eval(wos, 297,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 298,  "prob yes", "lab exp")
wos <- ma.eval(wos, 299,  "no", "evo")
wos <- ma.eval(wos, 300,  "no", "evo")
wos <- ma.eval(wos, 301,  "prob not", "seems intra")
wos <- ma.eval(wos, 302,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 303,  "prob not", "seems intra")
wos <- ma.eval(wos, 304,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 305,  "no", "human")
wos <- ma.eval(wos, 306,  "no", "human")
wos <- ma.eval(wos, 307,  "no", "human")
wos <- ma.eval(wos, 308,  "no", "human")
wos <- ma.eval(wos, 309,  "maybe", "read")
wos <- ma.eval(wos, 310,  "no", "economics")
wos <- ma.eval(wos, 311,  "prob not", "seems intra")
wos <- ma.eval(wos, 312,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 313,  "prob yes", "comp, field exp")
wos <- ma.eval(wos, 314,  "yes", "field exp")
wos <- ma.eval(wos, 315,  "no", "human")
wos <- ma.eval(wos, 316,  "no", "human")
wos <- ma.eval(wos, 317,  "prob not", "seems intra")
wos <- ma.eval(wos, 318,  "prob not", "pred, complex comm")
wos <- ma.eval(wos, 319,  "prob yes", "comp, lab exp")
wos <- ma.eval(wos, 320,  "maybe", "comp, complex comm, field exp")
wos <- ma.eval(wos, 320,  "maybe", "comp, complex comm, field exp")
wos <- ma.eval(wos, 321,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 322,  "no", "economics")
wos <- ma.eval(wos, 323,  "no", "obs")
wos <- ma.eval(wos, 324,  "no", "obs")
wos <- ma.eval(wos, 325,  "no", "economics")
wos <- ma.eval(wos, 326,  "no", "human")
wos <- ma.eval(wos, 327,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 328,  "maybe", "read, review")
wos <- ma.eval(wos, 329,  "no", "policy")
wos <- ma.eval(wos, 330,  "prob yes", "pred, lab exp")
wos <- ma.eval(wos, 331,  "no", "intra, herbicide")
wos <- ma.eval(wos, 332,  "no", "policy")
wos <- ma.eval(wos, 333,  "no", "intra, field exp")
wos <- ma.eval(wos, 334,  "no", "complex comm, field exp")
wos <- ma.eval(wos, 335,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 336,  "no", "obs")
wos <- ma.eval(wos, 337,  "maybe", "inter, field exp")
wos <- ma.eval(wos, 338,  "yes", "inter, field exp")
wos <- ma.eval(wos, 339,  "no", "economics")
wos <- ma.eval(wos, 340,  "maybe", "reivew, ma on evo defense cost")
wos <- ma.eval(wos, 341,  "no", "human")
wos <- ma.eval(wos, 342,  "no", "chemistry")
wos <- ma.eval(wos, 343,  "no", "human")
wos <- ma.eval(wos, 344,  "no", "human")
wos <- ma.eval(wos, 345,  "no", "ecosystem")
wos <- ma.eval(wos, 346,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 347,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 348,  "no", "human")
wos <- ma.eval(wos, 349,  "no", "human")
wos <- ma.eval(wos, 350,  "no", "human")
wos <- ma.eval(wos, 351,  "maybe", "seems intra, song callback")
wos <- ma.eval(wos, 352,  "no", "human")
wos <- ma.eval(wos, 353,  "no", "chemistry")
wos <- ma.eval(wos, 354,  "no", "human")
wos <- ma.eval(wos, 355,  "no", "human")

# Changed opinions
wos <- ma.eval(wos, 5,    "no", "obs")
wos <- ma.eval(wos, 6,    "prob not", "complex comm")
wos <- ma.eval(wos, 7,    "prob not", "no pred control")
wos <- ma.eval(wos, 20,   "no", "intra, no pred control")
wos <- ma.eval(wos, 21,   "maybe", "read")
wos <- ma.eval(wos, 23,   "no", "intra")
wos <- ma.eval(wos, 28,   "no", "nematicide")
wos <- ma.eval(wos, 40,   "prob not", "no comp control")
wos <- ma.eval(wos, 55,   "maybe", "foreign lang")
wos <- ma.eval(wos, 57,   "prob not", "complex comm")
wos <- ma.eval(wos, 61,   "prob not", "no error")
wos <- ma.eval(wos, 62,   "no", "proteins")
wos <- ma.eval(wos, 63,   "maybe", "obs")
wos <- ma.eval(wos, 66,   "maybe", "review")
wos <- ma.eval(wos, 175,  "prob not", "no error")
wos <- ma.eval(wos, 221,  "maybe", "temporal patterns")
wos <- ma.eval(wos, 227,  "prob not", "complex comm")
wos <- ma.eval(wos, 240,  "prob not", "evo")
wos <- ma.eval(wos, 248,  "prob yes", "evo")
wos <- ma.eval(wos, 281,  "prob yes", "read, review")
wos <- ma.eval(wos, 283,  "maybe", "read")
wos <- ma.eval(wos, 287,  "maybe", "read")
wos <- ma.eval(wos, 289,  "maybe", "read")
```

```{r, echo = `FALSE`}
# WoS
wos <- ma.eval(wos, 356,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 357,  "no", "chemistry")
wos <- ma.eval(wos, 358,  "maybe", "review of invasive pollinators, i think")
wos <- ma.eval(wos, 359,  "no", "human")
wos <- ma.eval(wos, 360,  "yes", "inter, exp")
wos <- ma.eval(wos, 361,  "no", "human")
wos <- ma.eval(wos, 361,  "no", "human")
wos <- ma.eval(wos, 362,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 363,  "no", "human")
wos <- ma.eval(wos, 364,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 365,  "prob yes", "herb, field exp")
wos <- ma.eval(wos, 366,  "no", "human")
wos <- ma.eval(wos, 367,  "prob yes", "herb, field exp")
wos <- ma.eval(wos, 368,  "maybe", "viral, lab exp")
wos <- ma.eval(wos, 369,  "yes", "pred, field exp")
wos <- ma.eval(wos, 369,  "yes", "pred, field exp")
wos <- ma.eval(wos, 370,  "maybe", "inter, complex comm, field exp")
wos <- ma.eval(wos, 371,  "prob no", "intra, field exp")
wos <- ma.eval(wos, 372,  "no", "human")
wos <- ma.eval(wos, 373,  "no", "human")
wos <- ma.eval(wos, 374,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 375,  "prob no", "inter, complex comm, field exp")
wos <- ma.eval(wos, 376,  "prob no", "inter, complex comm, field exp")
wos <- ma.eval(wos, 377,  "no", "human")
wos <- ma.eval(wos, 378,  "no", "human")
wos <- ma.eval(wos, 379,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 380,  "prob yes", "ma of native/invasive pol, field exp")
wos <- ma.eval(wos, 381,  "remove", "same as 380")
wos <- ma.eval(wos, 382,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 383,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 384,  "maybe", "parasitism, field exp")
wos <- ma.eval(wos, 385,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 386,  "maybe", "complex comm, field exp")
wos <- ma.eval(wos, 387,  "prob not", "intra, field exp")
wos <- ma.eval(wos, 388,  "no", "human")
wos <- ma.eval(wos, 389,  "no", "genes")
wos <- ma.eval(wos, 390,  "no", "cancer")
wos <- ma.eval(wos, 391,  "no", "teaching guide")
wos <- ma.eval(wos, 392,  "maybe", "read, ma of biological control")
wos <- ma.eval(wos, 393,  "no", "intra, field exp")
wos <- ma.eval(wos, 394,  "no", "genes")
wos <- ma.eval(wos, 395,  "no", "human")
wos <- ma.eval(wos, 396,  "no", "human")
wos <- ma.eval(wos, 397,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 398,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 399,  "no", "human")
wos <- ma.eval(wos, 400,  "no", "chemistry")
wos <- ma.eval(wos, 401,  "no", "human")
wos <- ma.eval(wos, 402,  "prob yes", "mut, field exp")
wos <- ma.eval(wos, 403,  "no", "human")
wos <- ma.eval(wos, 404,  "no", "human")
wos <- ma.eval(wos, 405,  "no", "human")
wos <- ma.eval(wos, 406,  "no", "human")
wos <- ma.eval(wos, 407,  "prob yes", "inter, field exp")
wos <- ma.eval(wos, 408,  "no", "economics")
wos <- ma.eval(wos, 409,  "no", "human")
wos <- ma.eval(wos, 410,  "maybe", "read, community phylogenetics")
wos <- ma.eval(wos, 411,  "no", "economics")
wos <- ma.eval(wos, 412,  "prob yes", "pred, field exp")
wos <- ma.eval(wos, 413,  "no", "human")

# Print or search abstract
ma.abstract(wos, 413)

# 350 is half
# Evaluate progress
ma.status(wos, es)
```

### Step 4: Extract data from text

```{r, echo = `FALSE`}
# Subset articles (yes)
yes <- wos %>%
  filter(include == "yes")

# Subset articles (prob yes)
prob.yes <- wos %>%
  filter(include == "prob yes")
```

### Step 5: Extract data from figures

```{r, echo = FALSE}
# Save file names
filenames <- list.files("/Users/simontye/Research/Projects/Meta_Analysis/2021_MetaAnalysis/papers/new_figs")

# Exclude metaDigitise folder
filenames <- filenames[!filenames %in% grep(paste0("caldat"),
                                            filenames,
                                            value = T)]

# File names and article ids
filenames <- data.frame(filename   = as.factor(all_of(filenames)),
                        article.id = c(
                          # Bontrager 2014
                          c(rep(226, 5)),
                          # Kenison 2016,
                          c(rep(314, 6)),
                          # Marino 2013
                          c(rep(174, 2)),
                          # Martinez 2015
                          c(rep(259, 3)),
                          # Nilsson 2014
                          #c(rep(190, 1)),
                          # Peptipas 2014
                          c(rep(225, 1)),
                          # Santos 2012
                          c(rep(105, 2)),
                          # Schadler 2010
                          c(rep(4, 1)),
                          # Segre 2013
                          c(rep(189, 4)),
                          # Vogt 2010
                          c(rep(39, 2))))

# Extract figure data
fig.data <- metaDigitise("/Users/simontye/Research/Projects/Meta_Analysis/2021_MetaAnalysis/papers/new_figs")

# Options to import all data
2
1

# Join WoS and figure data
fig.data <- fig.data %>%
  full_join(., filenames, by = c("filename")) %>%
  mutate(group_id = as.character(group_id))

# Split identifying information (group_id)
fig.detail <- strsplit(fig.data$group_id,',', fixed = FALSE)

# Convert list to df
fig.detail <- fig.detail %>%
  do.call(rbind.data.frame, .) %>%
  # Remove trailing/leading spaces
  mutate(across(where(is.character), str_trim))

# Rename columns (group_#)
for(i in 1:ncol(fig.detail)){
  # Isolate column
  colnames(fig.detail)[i] <- c(paste0("group.", i))
}

# Add separated details
fig.data <- fig.data %>%
  cbind(., fig.detail) %>%
  mutate(group_id = NULL)
```

# Bontrager 2014

```{r, echo = `FALSE`}
# Bontrager2014_Fig1.png
fig.data.1 <- fig.data %>%
  filter(filename == "Bontrager2014_Fig1.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", n, NA),
    n.c    = ifelse(group.1 == "Salix"    && group.2 == "cleared", n, n.c),
    n.c    = ifelse(group.1 == "Scirpus"  && group.2 == "cleared", n, n.c),
    # mean
    mean.c = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", mean, NA),
    mean.c = ifelse(group.1 == "Salix"    && group.2 == "cleared", mean, mean.c),
    mean.c = ifelse(group.1 == "Scirpus"  && group.2 == "cleared", mean, mean.c),
    # sd
    sd.c   = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", sd, NA),
    sd.c   = ifelse(group.1 == "Salix"    && group.2 == "cleared", sd, sd.c),
    sd.c   = ifelse(group.1 == "Scirpus"  && group.2 == "cleared", sd, sd.c),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", n, NA),
    n.e    = ifelse(group.1 == "Salix"    && group.2 == "not cleared", n, n.e),
    n.e    = ifelse(group.1 == "Scirpus"  && group.2 == "not cleared", n, n.e),
    # mean
    mean.e = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", mean, NA),
    mean.e = ifelse(group.1 == "Salix"    && group.2 == "not cleared", mean, mean.e),
    mean.e = ifelse(group.1 == "Scirpus"  && group.2 == "not cleared", mean, mean.e),
    # sd
    sd.e   = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", sd, NA),
    sd.e   = ifelse(group.1 == "Salix"    && group.2 == "not cleared", sd, sd.e),
    sd.e   = ifelse(group.1 == "Scirpus"  && group.2 == "not cleared", sd, sd.e)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "cleared",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Bontrager2014_Fig5a.png
fig.data.2 <- fig.data %>%
  filter(filename == "Bontrager2014_Fig5a.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", n, NA),
    n.c    = ifelse(group.1 == "Salix"    && group.2 == "cleared", n, n.c),
    # mean
    mean.c = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", mean, NA),
    mean.c = ifelse(group.1 == "Salix"    && group.2 == "cleared", mean, mean.c),
    # sd
    sd.c = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", sd, NA),
    sd.c = ifelse(group.1 == "Salix"    && group.2 == "cleared", sd, sd.c),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", n, NA),
    n.e    = ifelse(group.1 == "Salix"    && group.2 == "not cleared", n, n.e),
    # mean
    mean.e = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", mean, NA),
    mean.e = ifelse(group.1 == "Salix"    && group.2 == "not cleared", mean, mean.e),
    # sd
    sd.e   = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", sd, NA),
    sd.e   = ifelse(group.1 == "Salix"    && group.2 == "not cleared", sd, sd.e)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "cleared",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Bontrager2014_Fig5b.png
fig.data.3 <- fig.data %>%
  filter(filename == "Bontrager2014_Fig5b.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", n, NA),
    n.c    = ifelse(group.1 == "Salix"    && group.2 == "cleared", n, n.c),
    n.c    = ifelse(group.1 == "Scirpus"  && group.2 == "cleared", n, n.c),
    # mean
    mean.c = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", mean, NA),
    mean.c = ifelse(group.1 == "Salix"    && group.2 == "cleared", mean, mean.c),
    mean.c = ifelse(group.1 == "Scirpus"  && group.2 == "cleared", mean, mean.c),
    # sd
    sd.c   = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", sd, NA),
    sd.c   = ifelse(group.1 == "Salix"    && group.2 == "cleared", sd, sd.c),
    sd.c   = ifelse(group.1 == "Scirpus"  && group.2 == "cleared", sd, sd.c),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", n, NA),
    n.e    = ifelse(group.1 == "Salix"    && group.2 == "not cleared", n, n.e),
    n.e    = ifelse(group.1 == "Scirpus"  && group.2 == "not cleared", n, n.e),
    # mean
    mean.e = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", mean, NA),
    mean.e = ifelse(group.1 == "Salix"    && group.2 == "not cleared", mean, mean.e),
    mean.e = ifelse(group.1 == "Scirpus"  && group.2 == "not cleared", mean, mean.e),
    # sd
    sd.e   = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", sd, NA),
    sd.e   = ifelse(group.1 == "Salix"    && group.2 == "not cleared", sd, sd.e),
    sd.e   = ifelse(group.1 == "Scirpus"  && group.2 == "not cleared", sd, sd.e)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "cleared",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Bontrager2014_Fig5c.png
fig.data.4 <- fig.data %>%
  filter(filename == "Bontrager2014_Fig5c.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "cleared",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Bontrager2014_Fig5d.png
fig.data.5 <- fig.data %>%
  filter(filename == "Bontrager2014_Fig5d.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Oenanthe" && group.2 == "cleared", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Oenanthe" && group.2 == "not cleared", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "cleared",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Combine fig.data
working.fig.data <- fig.data.1 %>%
  full_join(., fig.data.2) %>%
  full_join(., fig.data.3) %>%
  full_join(., fig.data.4) %>%
  full_join(., fig.data.5)

# Remove objects
rm(fig.data.1, fig.data.2, fig.data.3,
   fig.data.4, fig.data.5)
```

# Kennison 2016

```{r, echo = FALSE}
# Kenison2016_Fig2a.png
fig.data.1 <- fig.data %>%
  filter(filename == "Kenison2016_Fig2a.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Salamander" && group.2 == "no trout", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Salamander" && group.2 == "no trout", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Salamander" && group.2 == "no trout", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Salamander" && group.2 == "trout", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Salamander" && group.2 == "trout", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Salamander" && group.2 == "trout", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "trout",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Kenison2016_Fig2b.png
fig.data.2 <- fig.data %>%
  filter(filename == "Kenison2016_Fig2b.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Salamander" && group.2 == "no trout", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Salamander" && group.2 == "no trout", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Salamander" && group.2 == "no trout", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Salamander" && group.2 == "trout", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Salamander" && group.2 == "trout", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Salamander" && group.2 == "trout", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "trout",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Kenison2016_Fig2c.png
fig.data.3 <- fig.data %>%
  filter(filename == "Kenison2016_Fig2c.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Salamander" && group.2 == "no trout", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Salamander" && group.2 == "no trout", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Salamander" && group.2 == "no trout", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Salamander" && group.2 == "trout", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Salamander" && group.2 == "trout", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Salamander" && group.2 == "trout", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "trout",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Kenison2016_Fig2d.png
fig.data.4 <- fig.data %>%
  filter(filename == "Kenison2016_Fig2d.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Salamander" && group.2 == "no trout", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Salamander" && group.2 == "no trout", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Salamander" && group.2 == "no trout", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Salamander" && group.2 == "trout", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Salamander" && group.2 == "trout", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Salamander" && group.2 == "trout", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "trout",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Kenison2016_Fig2e.png
fig.data.5 <- fig.data %>%
  filter(filename == "Kenison2016_Fig2e.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Salamander" && group.2 == "no trout", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Salamander" && group.2 == "no trout", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Salamander" && group.2 == "no trout", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Salamander" && group.2 == "trout", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Salamander" && group.2 == "trout", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Salamander" && group.2 == "trout", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "trout",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Kenison2016_Fig2f.png
fig.data.6 <- fig.data %>%
  filter(filename == "Kenison2016_Fig2f.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Salamander" && group.2 == "no trout", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Salamander" && group.2 == "no trout", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Salamander" && group.2 == "no trout", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Salamander" && group.2 == "trout", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Salamander" && group.2 == "trout", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Salamander" && group.2 == "trout", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "trout",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Combine fig.data
working.fig.data <- working.fig.data %>%
  full_join(., fig.data.1) %>%
  full_join(., fig.data.2) %>%
  full_join(., fig.data.3) %>%
  full_join(., fig.data.4) %>%
  full_join(., fig.data.5) %>%
  full_join(., fig.data.6)

# Remove objects
rm(fig.data.1, fig.data.2, fig.data.3,
   fig.data.4, fig.data.5, fig.data.6)
```

# Marino 2013

```{r, echo = FALSE}
# Marino2013_Fig1a.png
fig.data.1 <- fig.data %>%
  filter(filename == "Marino2013_Fig1a.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Green frog larvae" && group.2 == "no predator" && group.3 == "no parasite", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Green frog larvae" && group.2 == "no predator" && group.3 == "no parasite", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Green frog larvae" && group.2 == "no predator" && group.3 == "no parasite", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Green frog larvae" && group.2 == "free predator" && group.3 == "no parasite", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Green frog larvae" && group.2 == "free predator" && group.3 == "no parasite", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Green frog larvae" && group.2 == "free predator" && group.3 == "no parasite", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "Anax",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Marino2013_Fig1b.png
fig.data.2 <- fig.data %>%
  filter(filename == "Marino2013_Fig1b.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Green frog larvae" && group.2 == "no predator" && group.3 == "no parasite", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Green frog larvae" && group.2 == "no predator" && group.3 == "no parasite", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Green frog larvae" && group.2 == "no predator" && group.3 == "no parasite", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Green frog larvae" && group.2 == "free predator" && group.3 == "no parasite", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Green frog larvae" && group.2 == "free predator" && group.3 == "no parasite", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Green frog larvae" && group.2 == "free predator" && group.3 == "no parasite", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c     = max(n.c, na.rm = TRUE),
                   mean.c  = max(mean.c, na.rm = TRUE),
                   sd.c    = max(sd.c, na.rm = TRUE),
                   n.e     = max(n.e, na.rm = TRUE),
                   mean.e  = max(mean.e, na.rm = TRUE),
                   sd.e    = max(sd.e, na.rm = TRUE),
                   group.2 = "Anax",
                   group.3 = as.character(NA),
                   group.4 = as.character(NA)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Combine fig.data
working.fig.data <- working.fig.data %>%
  full_join(., fig.data.1) %>%
  full_join(., fig.data.2)

# Remove objects
rm(fig.data.1, fig.data.2)
```

# Martinez 2015
### need to fix diff groups here, locations not working or some shit

```{r, echo = FALSE}
# Martinez2015_Fig2a.png
fig.data.1 <- fig.data %>%
  filter(filename == "Martinez2015_Fig2a.png") %>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Croajingolong", n, NA),
     # n
    n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Grampians", n, NA),
    n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Brisbane Ranges", n, NA),
     n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Dandenong Ranges", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Croajingolong", mean, mean.c),
    # sd
    sd.c   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Croajingolong", sd, NA),
    # n
    n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Grampians", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Grampians", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Grampians", sd, NA),
    n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Brisbane Ranges", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Brisbane Ranges", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Brisbane Ranges", sd, NA),
    n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Dandenong Ranges", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Dandenong Ranges", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant" && group.4 == "Dandenong Ranges", sd, NA),    
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Croajingolong", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Croajingolong", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Croajingolong", sd, NA),
    # n
    n.e    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Grampians", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Grampians", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Grampians", sd, NA),
    n.e    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Brisbane Ranges", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Brisbane Ranges", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Brisbane Ranges", sd, NA),
    n.e    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Dandenong Ranges", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Dandenong Ranges", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant" && group.4 == "Dandenong Ranges", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL)



    # Remove old group columns
    group.2    = NULL,
    group.3    = NULL,
    group.4    = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c    = max(n.c, na.rm = TRUE),
                   mean.c = max(mean.c, na.rm = TRUE),
                   sd.c   = max(sd.c, na.rm = TRUE),
                   n.e    = max(n.e, na.rm = TRUE),
                   mean.e = max(mean.e, na.rm = TRUE),
                   sd.e   = max(sd.e, na.rm = TRUE)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Martinez2015_Fig2b.png
fig.data.2 <- fig.data %>%
  filter(filename == "Martinez2015_Fig2b.png")

%>%
  dplyr::rowwise() %>%
  mutate(
    ### Control
    # n
    n.c    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant", n, NA),
    # mean
    mean.c = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant", mean, NA),
    # sd
    sd.c   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "no ant", sd, NA),
    ### Experimental
    # n
    n.e    = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant", n, NA),
    # mean
    mean.e = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant", mean, NA),
    # sd
    sd.e   = ifelse(group.1 == "Acacia myrtifolia" && group.2 == "ant", sd, NA)) %>%
  mutate(
    # Remove old stats columns
    mean       = NULL,
    sd         = NULL,
    n          = NULL,
    r          = NULL,
    se         = NULL,
    error_type = NULL,
    plot_type  = NULL,
    # Remove old group columns
    group.2    = NULL,
    group.3    = NULL,
    group.4    = NULL) %>%
  # Merge control and experimental rows
  group_by(filename, variable, article.id, group.1) %>%
  dplyr::summarize(n.c    = max(n.c, na.rm = TRUE),
                   mean.c = max(mean.c, na.rm = TRUE),
                   sd.c   = max(sd.c, na.rm = TRUE),
                   n.e    = max(n.e, na.rm = TRUE),
                   mean.e = max(mean.e, na.rm = TRUE),
                   sd.e   = max(sd.e, na.rm = TRUE)) %>%
  # Replace any missing values (Inf) with NAs
  mutate_at(., vars (-group_cols()), function(x) ifelse(is.infinite(x), NA, x))

# Combine fig.data
working.fig.data <- rbind(working.fig.data,
                          fig.data.1, fig.data.2)

# Remove objects
rm(fig.data.1, fig.data.2)
```

### Step 5: Quick plots

```{r, echo = `FALSE`}
# Subset current data
current <- es %>%
  filter(!is.na(include)) %>%
  filter(include == "yes") %>%
  mutate(
    # Data
    interaction = as.factor(interaction),
    trait       = as.factor(trait),
    # Effect sizes
    es          = as.numeric(es),
    es.se       = as.numeric(es.se),
    es.var      = as.numeric(es.var),
    es.ci.upper = as.numeric(es.ci.upper),
    es.ci.lower = as.numeric(es.ci.lower),
    es.w        = as.numeric(es.w)) #%>%
  #filter(type == "comp" | type == "no_comp")

# Rename factors (filtered to comp only)
#levels(current$type) <- list(Present  = "comp",
#                             Absent   = "no_comp")

# Quick plot
ggplot() +
  geom_point(current, mapping = aes(x = es,
                                    y = trait,
                                    color = trait),
                                    #shape = interaction),
             size = 2, alpha = 0.5, position = "jitter") +
  #geom_errorbar(current, mapping = aes(xmin = (es - es.se),
  #                                     xmax = (es + es.se),
  #                                     y    = type),
  #              width = 0.1) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  labs(x = "Effect size (d)",
       y = "Trait",
       color = "Trait") +
  #scale_color_manual(values = c("blue"),
  #                   labels = c("Competition")) +
  scale_x_continuous(limits = c(-2, 2)) +
  pretty
```

### Notes

```{r, echo = `FALSE`}
# ES 1_1
es <- ma.es(yes, es, 1,
            data.frame(comment       = "Table 6",
                       es.id         = "1_1",
                       focal.species = "Rana utricularia",
                       focal.n       = 275,
                       focal.density = NA,
                       focal.size    = NA,
                       mut.species   = NA,
                       mut.n         = NA,
                       mut.density   = NA,
                       mut.size      = NA,
                       comp.species  = "Several",
                       comp.n        = "Many",
                       comp.density  = NA,
                       comp.size     = NA,
                       pred.species  = "Notophthalmus viridescens dorsalis",
                       pred.n        = 2,
                       pred.density  = NA,
                       pred.size     = NA,
                       interaction   = "Predation and competition",
                       trait         = "Survivorship",
                       treatment     = NA,
                       location      = "Duke Zoology Field Station, Durham, NC",
                       measure       = "Mean",
                       direction     = "-",
                       n.c           = 2,
                       mean.c        = 0.17,
                       error.c       = 0.04,
                       error.type.c  = "sd",
                       n.e           = 5,
                       mean.e        = 0.24,
                       error.e       = 0.14,
                       error.type.e  = "sd"))


```

```{r, echo = `FALSE`}
# ES 1_1
es <- ma.es(yes, es, 1,
            data.frame(comment       = "Table 6",
                       es.id         = "1_1",
                       focal.species = "Rana utricularia",
                       focal.n       = 275,
                       focal.density = NA,
                       focal.size    = NA,
                       mut.species   = NA,
                       mut.n         = NA,
                       mut.density   = NA,
                       mut.size      = NA,
                       comp.species  = "Several",
                       comp.n        = "Many",
                       comp.density  = NA,
                       comp.size     = NA,
                       pred.species  = "Notophthalmus viridescens dorsalis",
                       pred.n        = 2,
                       pred.density  = NA,
                       pred.size     = NA,
                       interaction   = "Predation and competition",
                       trait         = "Survivorship",
                       treatment     = NA,
                       location      = "Duke Zoology Field Station, Durham, NC",
                       measure       = "Mean",
                       direction     = "-",
                       n.c           = 2,
                       mean.c        = 0.17,
                       error.c       = 0.04,
                       error.type.c  = "sd",
                       n.e           = 5,
                       mean.e        = 0.24,
                       error.e       = 0.14,
                       error.type.e  = "sd"))





# ES 17_2
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6",
                            es.id         = "1_2",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 4,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Survivorship",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 0.17,
                            error.c       = 0.04,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 0.16,
                            error.e       = 0.11,
                            error.type.e  = "sd"))

# ES 17_3
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, % metamorph",
                            es.id         = "1_3",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Development",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "+",
                            n.c           = 2,
                            mean.c        = 0.10,
                            error.c       = 0.11,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 0.20,
                            error.e       = 0.45,
                            error.type.e  = "sd"))

# ES 17_4
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, % metamorph",
                            es.id         = "1_4",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 4,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Development",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "+",
                            n.c           = 2,
                            mean.c        = 0.10,
                            error.c       = 0.11,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 0.22,
                            error.e       = 0.43,
                            error.type.e  = "sd"))

##############################################################################

# ES 17_5
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, % metamorph",
                            es.id         = "1_5",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density  = NA,
                            focal.size     = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Biomass",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 916.3,
                            error.c       = 116.0,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 1329.0,
                            error.e       = 376.2,
                            error.type.e  = "sd"))

# ES 17_6
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, % metamorph",
                            es.id         = "1_6",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 4,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Biomass",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 916.3,
                            error.c       = 116.0,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 880.3,
                            error.e       = 321.7,
                            error.type.e  = "sd"))

##############################################################################

# ES 17_7
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, larval period",
                            es.id         = "1_7",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Development",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 151.2,
                            error.c       = 5.9,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 136.0,
                            error.e       = 4.8,
                            error.type.e  = "sd"))

# ES 17_8
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, larval period",
                            es.id         = "1_8",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 4,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Development",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 151.2,
                            error.c       = 5.9,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 96.7,
                            error.e       = 21.2,
                            error.type.e  = "sd"))

##############################################################################

# ES 17_9
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, growth rate",
                            es.id         = "1_9",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Growth rate",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "+",
                            n.c           = 2,
                            mean.c        = 6.1,
                            error.c       = 0.5,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 10.9,
                            error.e       = 6.6,
                            error.type.e  = "sd"))

# ES 17_10
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, growth rate",
                            es.id         = "1_10",
                            focal.species = "Rana utricularia",
                            focal.n       = 275,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Growth rate",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "+",
                            n.c           = 4,
                            mean.c        = 6.1,
                            error.c       = 0.5,
                            error.type.c  = "sd",
                            n.e           = 5,
                            mean.e        = 9.0,
                            error.e       = 1.4,
                            error.type.e  = "sd"))

##############################################################################

# ES 17_11
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, growth rate",
                            es.id         = "1_11",
                            focal.species = "Bufo americanus",
                            focal.n       = 25,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Survivorship",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 0.16,
                            error.c       = 0.11,
                            error.type.c  = "sd",
                            n.e           = 2,
                            mean.e        = 0.08,
                            error.e       = 0.11,
                            error.type.e  = "sd"))

# ES 17_12
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, mass at meta",
                            es.id         = "1_12",
                            focal.species = "Bufo americanus",
                            focal.n       = 25,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Biomass",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 152.1,
                            error.c       = 24.4,
                            error.type.c  = "sd",
                            n.e           = 2,
                            mean.e        = 163.3,
                            error.e       = 7.8,
                            error.type.e  = "sd"))

# ES 17_13
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, larval period",
                            es.id         = "1_13",
                            focal.species = "Bufo americanus",
                            focal.n       = 25,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Development",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "-",
                            n.c           = 2,
                            mean.c        = 40.6,
                            error.c       = 0.9,
                            error.type.c  = "sd",
                            n.e           = 2,
                            mean.e        = 39.3,
                            error.e       = 0.5,
                            error.type.e  = "sd"))

# ES 17_14
es <- ma.es(wos, es, 1,
                 data.frame(comment       = "Table 6, larval period",
                            es.id         = "1_14",
                            focal.species = "Bufo americanus",
                            focal.n       = 25,
                            focal.density = NA,
                            focal.size    = NA,
                            comp.species  = "Several",
                            comp.n        = "Many",
                            comp.density  = NA,
                            comp.size     = NA,
                            pred.species  = "Notophthalmus viridescens dorsalis",
                            pred.n        = 2,
                            pred.density  = NA,
                            pred.size     = NA,
                            interaction   = "Predation and competition",
                            trait         = "Growth rate",
                            location      = "Duke Zoology Field Station, Durham, NC",
                            measure       = "Mean",
                            direction     = "+",
                            n.c           = 2,
                            mean.c        = 3.7,
                            error.c       = 0.6,
                            error.type.c  = "sd",
                            n.e           = 2,
                            mean.e        = 4.1,
                            error.e       = 0.2,
                            error.type.e  = "sd"))
```

